(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/tabs/index/index"],{"1e24":function(e,t,n){"use strict";n.r(t);var o=n("36c5"),a=n.n(o);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);t["default"]=a.a},"36c5":function(e,t,n){"use strict";(function(e){var o=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n("7eb4")),i=o(n("ee10")),r=o(n("435b")),u=o(n("9a2d")),l=o(n("c118")),s={components:{ZhuigeSwiper:function(){n.e("components/zhuige-swiper").then(function(){return resolve(n("fcc3"))}.bind(null,n)).catch(n.oe)},ZhuigeIcons:function(){n.e("components/zhuige-icons").then(function(){return resolve(n("c641"))}.bind(null,n)).catch(n.oe)},zhuigeHeightPredict:function(){n.e("components/zhuige-height-predict").then(function(){return resolve(n("b945"))}.bind(null,n)).catch(n.oe)},ZhuigeSgztmkModule:function(){n.e("components/zhuige-sgztmk-module").then(function(){return resolve(n("7140"))}.bind(null,n)).catch(n.oe)}},data:function(){return{isLoading:!0,logo:void 0,style:"",slides:[],icons:[],heightData:this.getDefaultHeightData(),apiBaseUrl:"https://x.erquhealth.com/wp-json/zhuige/sgtool",sgztmkModules:[],isModulesLoading:!0}},onLoad:function(){this.refresh(),this.fetchUserHeightData()},onShow:function(){this.refresh();var t=e.getStorageSync("zhuige_xcx_user");t&&t.user_id?this.fetchUserHeightData():this.heightData=this.getDefaultHeightData()},methods:{openLink:function(e){r.default.openLink(e)},refresh:function(){this.loadSetting()},loadSetting:function(){var e=this;l.default.post(u.default.URL("setting","home")).then((function(t){e.logo=t.data.logo,e.slides=t.data.slides,e.icons=t.data.icons,t.data.style&&(e.style=t.data.style),e.fetchSgztmkModules(),e.isLoading=!1})).catch((function(t){console.log(t),e.isLoading=!1}))},getDefaultHeightData:function(){return{currentHeight:165,geneticHeight:175,targetHeight:180,probability:85,baobaoname:"演示宝宝",updateTime:""}},fetchUserHeightData:function(){var t=this;return(0,i.default)(a.default.mark((function n(){var o,i,r;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.getStorageSync("zhuige_xcx_user"),console.log("开始获取身高数据，用户认证信息：",o),o&&o.user_id){n.next=7;break}return console.log("用户未登录，使用默认数据"),t.heightData=t.getDefaultHeightData(),t.isLoading=!1,n.abrupt("return");case 7:return n.prev=7,console.log("准备发起API请求，用户ID：",o.user_id),n.next=11,e.request({url:"".concat(t.apiBaseUrl,"/get_user_height_data"),method:"GET",data:{user_id:o.user_id},header:{"content-type":"application/json"}});case 11:i=n.sent,console.log("API响应数据：",i),200===i.statusCode&&i.data&&0===i.data.code&&(r=i.data.data,console.log("解析到的用户身高数据：",r),r&&r.baobaoname&&r.current_height&&r.target_height&&r.prediction_probability?(console.log("检测到完整的宝宝档案，更新所有数据"),t.heightData={geneticHeight:Number(1===r.gender?r.boy_genetic_height:r.girl_genetic_height),currentHeight:Number(r.current_height),targetHeight:Number(r.target_height),probability:Number(r.prediction_probability),baobaoname:r.baobaoname,updateTime:r.create_time},console.log("更新后的heightData：",t.heightData)):(console.log("未检测到完整的宝宝档案数据，使用默认数据"),t.heightData=t.getDefaultHeightData())),n.next=21;break;case 16:n.prev=16,n.t0=n["catch"](7),console.error("API请求失败：",n.t0),e.showToast({title:"获取数据失败",icon:"none"}),t.heightData=t.getDefaultHeightData();case 21:return n.prev=21,t.isLoading=!1,n.finish(21);case 24:case"end":return n.stop()}}),n,null,[[7,16,21,24]])})))()},fetchSgztmkModules:function(){var t=this;return(0,i.default)(a.default.mark((function n(){var o,r;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return console.log("[身高专题模块] 开始获取模块数据"),t.isModulesLoading=!0,n.prev=2,console.log("[身高专题模块] 请求基础数据API"),n.next=6,l.default.post(u.default.URL("sgtool","get_sgztmk_modules"));case 6:if(o=n.sent,!o.data||!Array.isArray(o.data.modules)){n.next=16;break}return console.log("[身高专题模块] 获取到基础数据：",o.data.modules),r=e.getStorageSync("zhuige_xcx_user"),console.log("[身高专题模块] 用户认证状态：",r?"已登录":"未登录",r),n.next=13,Promise.all(o.data.modules.map(function(){var t=(0,i.default)(a.default.mark((function t(n){var o,i,u,l,s,c,d,g;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n.left_module.value_api){t.next=19;break}if(o="60",!r||!r.user_id){t.next=17;break}return t.prev=3,i=n.left_module.value_api.replace("{user_id}",r.user_id),console.log("身高专题模块：请求API",i),t.next=8,e.request({url:i,method:"GET",header:{"content-type":"application/json"}});case 8:u=t.sent,u.data&&200===u.data.code&&u.data.data&&(l=u.data.data,console.log("[身高专题模块] API返回数据：",l),Array.isArray(l)&&l.length>0&&(s=l[l.length-1],console.log("[身高专题模块] 最新记录：",s),c=i.split("?")[1],d=c.match(/fields=([^&]*)/),g=d?d[1]:null,console.log("[身高专题模块] 提取字段名：",g),g&&void 0!==s[g]&&(o=Number(s[g]).toFixed(1),console.log("[身高专题模块] 更新数值：",{field:g,value:o})))),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](3),console.error("身高专题模块：获取模块数值失败:",t.t0);case 15:t.next=18;break;case 17:console.log("身高专题模块：用户未登录，使用默认值");case 18:n.left_module.value=o;case 19:return t.abrupt("return",n);case 20:case"end":return t.stop()}}),t,null,[[3,12]])})));return function(e){return t.apply(this,arguments)}}()));case 13:t.sgztmkModules=n.sent,n.next=18;break;case 16:t.sgztmkModules=[],console.log("身高专题模块：没有可用的模块数据");case 18:n.next=24;break;case 20:n.prev=20,n.t0=n["catch"](2),console.error("身高专题模块：获取模块失败:",n.t0),t.sgztmkModules=[];case 24:return n.prev=24,t.isModulesLoading=!1,n.finish(24);case 27:case"end":return n.stop()}}),n,null,[[2,20,24,27]])})))()}}};t.default=s}).call(this,n("df3c")["default"])},"703d":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return o}));var o={uniNavBar:function(){return n.e("uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar").then(n.bind(null,"1f4e"))},uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,"d68c"))}},a=function(){var e=this,t=e.$createElement,n=(e._self._c,e.slides&&e.slides.length>0),o=e.icons&&e.icons.length>0,a=!e.isModulesLoading&&e.sgztmkModules&&e.sgztmkModules.length>0,i=a?e.__map(e.sgztmkModules,(function(t,n){var o=e.__get_orig(t),a={title:t.left_module.title,icon:t.icon,description:t.left_module.description,image:t.left_module.image,buttonText:t.left_module.button_text,link:t.left_module.link,value:t.left_module.value,bgColor:t.left_module.bg_color},i={title:t.right_top_module.title,description:t.right_top_module.description,image:t.right_top_module.image,buttonText:t.right_top_module.button_text,link:t.right_top_module.link,bgColor:t.right_top_module.bg_color},r={title:t.right_bottom_module.title,description:t.right_bottom_module.description,image:t.right_bottom_module.image,buttonText:t.right_bottom_module.button_text,link:t.right_bottom_module.link,bgColor:t.right_bottom_module.bg_color};return{$orig:o,a0:a,a1:i,a2:r}})):null;e.$mp.data=Object.assign({},{$root:{g0:n,g1:o,g2:a,l0:i}})},i=[]},"87f1":function(e,t,n){"use strict";n.r(t);var o=n("703d"),a=n("1e24");for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);n("9502");var r=n("828b"),u=Object(r["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);t["default"]=u.exports},9502:function(e,t,n){"use strict";var o=n("bcd8"),a=n.n(o);a.a},bcd8:function(e,t,n){},becb:function(e,t,n){"use strict";(function(e,t){var o=n("47a9");n("1e94");o(n("3240"));var a=o(n("87f1"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])}},[["becb","common/runtime","common/vendor"]]]);