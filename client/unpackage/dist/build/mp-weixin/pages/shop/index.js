(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/shop/index"],{"141b":function(o,e,t){"use strict";(function(o,e){var n=t("47a9");t("1e94");n(t("3240"));var i=n(t("c3a5"));o.__webpack_require_UNI_MP_PLUGIN__=t,e(i.default)}).call(this,t("3223")["default"],t("df3c")["createPage"])},"35b1":function(o,e,t){"use strict";t.r(e);var n=t("e2df"),i=t.n(n);for(var a in n)["default"].indexOf(a)<0&&function(o){t.d(e,o,(function(){return n[o]}))}(a);e["default"]=i.a},"5cfd":function(o,e,t){},9494:function(o,e,t){"use strict";var n=t("5cfd"),i=t.n(n);i.a},c3a5:function(o,e,t){"use strict";t.r(e);var n=t("d107"),i=t("35b1");for(var a in i)["default"].indexOf(a)<0&&function(o){t.d(e,o,(function(){return i[o]}))}(a);t("9494");var r=t("828b"),s=Object(r["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);e["default"]=s.exports},d107:function(o,e,t){"use strict";t.d(e,"b",(function(){return i})),t.d(e,"c",(function(){return a})),t.d(e,"a",(function(){return n}));var n={uniNavBar:function(){return t.e("uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar").then(t.bind(null,"1f4e"))},uniIcons:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(t.bind(null,"d68c"))},uniLoadMore:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-load-more/components/uni-load-more/uni-load-more")]).then(t.bind(null,"45ad"))}},i=function(){var o=this,e=o.$createElement,t=(o._self._c,o.slides&&o.slides.length>0),n=o.icon_navs&&o.icon_navs.length>0,i=o.home_rec&&o.home_rec.posts&&o.home_rec.posts.length>0,a=i?o.__map(o.home_rec.posts,(function(e,t){var n=o.__get_orig(e),i=o.getGoodsThumbnail(e);return{$orig:n,m0:i}})):null,r=o.goods_list.length,s=r>0?o.__map(o.goods_list,(function(e,t){var n=o.__get_orig(e),i=o.getGoodsThumbnail(e);return{$orig:n,m1:i}})):null;o.$mp.data=Object.assign({},{$root:{g0:null,g1:null,g2:t,g3:n,g4:i,l0:a,g5:r,l1:s}})},a=[]},e2df:function(o,e,t){"use strict";(function(o){var n=t("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n(t("af34")),a=n(t("7ca3")),r=n(t("462b")),s=n(t("435b")),l=(n(t("85d8")),n(t("9a2d"))),c=(n(t("c118")),t("8f59"));function d(o,e){var t=Object.keys(o);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(o);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),t.push.apply(t,n)}return t}function u(o){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?d(Object(t),!0).forEach((function(e){(0,a.default)(o,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(t)):d(Object(t)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(t,e))}))}return o}var f={name:"ShopHome",components:{JiangqieNoData:function(){t.e("components/zhuige-nodata").then(function(){return resolve(t("5081"))}.bind(null,t)).catch(t.oe)}},data:function(){return this.share_title=void 0,this.share_thumb=void 0,{background:void 0,title:"",nav_color:"rgb(255, 255, 255)",nav_bgcolor:"rgba(255, 255, 255, 0)",slides:[],icon_navs:[],home_rec:void 0,cats:[],cat_id:void 0,goods_list:[],loadMore:"more",loaded:!1,pop_ad:void 0}},computed:u({},(0,c.mapGetters)(["getCartCount"])),onLoad:function(){this.goods_list=[],this.loaded=!1,this.loadMore="more",this.loadSetting(),this.loadGoods()},onShow:function(){s.default.updateCartBadge(this.getCartCount)},onPageScroll:function(e){if(e.scrollTop>20){var t=(e.scrollTop-20)/255;if(t<=1){var n=255*(1-t);this.nav_color="rgb(".concat(n,", ").concat(n,", ").concat(n,")"),this.nav_bgcolor="rgba(255, 255, 255, ".concat(t,")"),this.title="商城"}else"rgb(255, 255, 255)"!=this.nav_color&&(this.nav_color="rgb(0, 0, 0)",this.nav_bgcolor="rgba(255, 255, 255, 1)");o.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#ffffff"})}else this.nav_color="rgb(255, 255, 255)",this.nav_bgcolor="rgba(255, 255, 255, 0)",this.title="",o.setNavigationBarColor({frontColor:"#ffffff",backgroundColor:"#ffffff"})},onReachBottom:function(){"more"==this.loadMore&&this.loadGoods()},onPullDownRefresh:function(){this.refresh()},methods:{refresh:function(){this.loadSetting(),this.loaded=!1,this.goods_list=[],this.loadGoods()},clickLink:function(e){e&&"#"!==e&&"javascript:;"!==e?"/pages/shop/search/search"!==e?0!==e.indexOf("/pages/shop/detail/detail")?s.default.openLink(e):o.navigateTo({url:e,fail:function(e){console.error("商品详情页面跳转失败:",e),o.showToast({title:"商品详情暂未开放",icon:"none"})}}):o.navigateTo({url:e,fail:function(e){console.error("搜索页面跳转失败:",e),o.showToast({title:"搜索功能暂未开放",icon:"none"})}}):o.showToast({title:"该功能暂未开放",icon:"none"})},clickTab:function(o){this.cat_id=o,this.loaded=!1,this.goods_list=[],this.loadGoods()},clickCategory:function(){o.navigateTo({url:"/pages/shop/category/category"})},loadSetting:function(){var e=this;console.log("开始加载商城设置"),o.showLoading({title:"加载中..."});var t=(new Date).getTime();o.request({url:l.default.URL("shop","")+"?_t="+t,success:function(t){if(console.log("商城设置接口返回数据:",t.data),t.data&&0===t.data.code){var n=t.data.data;getApp().globalData.appName=n.title,getApp().globalData.appDesc=n.desc,e.background=n.background,e.share_title=n.home_title,e.share_thumb=n.thumb,console.log("幻灯片数据:",n.slides),console.log("导航项数据:",n.icon_navs),console.log("推荐商品数据:",n.home_rec),console.log("分类数据:",n.cats),e.slides=n.slides||[],e.icon_navs=n.icon_navs||[],n.home_rec&&n.home_rec.posts?(n.home_rec.posts=n.home_rec.posts.map((function(o){return u(u({},o),{},{price:void 0!==o.price?o.price:"",orig_price:void 0!==o.orig_price?o.orig_price:"",badge:void 0!==o.badge?o.badge:""})})),e.home_rec=n.home_rec,console.log("处理后的推荐商品数据:",e.home_rec)):(e.home_rec={title:"推荐商品",posts:[]},console.log("未找到推荐商品数据，使用默认值")),n.cats&&n.cats.length>0?(e.cats=n.cats,e.cat_id=e.cats[0].id):(e.cats=[],e.cat_id=void 0),e.pop_ad=s.default.getPopAd(n.pop_ad,r.default.ZHUIGE_INDEX_MAXAD_LAST_TIME)}else console.error("加载商城设置失败:",t.data),o.showToast({title:"加载商城设置失败",icon:"none"});o.stopPullDownRefresh(),o.hideLoading()},fail:function(e){console.error("请求商城设置接口失败:",e),o.stopPullDownRefresh(),o.hideLoading(),o.showToast({title:"网络请求失败",icon:"none"})}})},loadGoods:function(){var e=this;if("loading"!=this.loadMore){this.loadMore="loading",this.goods_list.length||o.showLoading({title:"加载中..."});var t=(new Date).getTime(),n={offset:this.goods_list.length,_t:t};this.cat_id&&(n.cat_id=this.cat_id),console.log("请求商品列表参数:",n),o.request({url:l.default.URL("shop","last"),method:"GET",data:n,success:function(t){if(console.log("商品列表接口返回数据:",t.data),t.data&&0===t.data.code){var n=t.data.data.list||[];console.log("处理前的商品列表:",n);var a=n.map((function(o){return u(u({},o),{},{thumbnail:o.thumbnail||(o.featured_image?o.featured_image:null),price:void 0!==o.price?o.price:"",orig_price:void 0!==o.orig_price?o.orig_price:"",badge:void 0!==o.badge?o.badge:"",slide:o.slide||[]})}));console.log("处理后的商品列表:",a),0===e.goods_list.length?e.goods_list=a:e.goods_list=[].concat((0,i.default)(e.goods_list),(0,i.default)(a)),e.loadMore=t.data.data.more,e.loaded=!0}else console.error("加载商品列表失败:",t.data),e.loadMore="noMore",e.loaded=!0,o.showToast({title:"加载商品列表失败",icon:"none"});o.hideLoading()},fail:function(t){console.error("请求商品列表接口失败:",t),e.loadMore="noMore",e.loaded=!0,o.hideLoading(),o.showToast({title:"网络请求失败",icon:"none"})}})}},clickPopAd:function(){o.setStorageSync(r.default.ZHUIGE_INDEX_MAXAD_LAST_TIME,(new Date).getTime()),s.default.openLink(this.pop_ad.link),this.pop_ad=!1},clickPopAdClose:function(){this.pop_ad=!1,o.setStorageSync(r.default.ZHUIGE_INDEX_MAXAD_LAST_TIME,(new Date).getTime())},getGoodsThumbnail:function(o){if(o.thumbnail&&!o.thumbnail.includes("zhuige-xcx/public/images"))return o.thumbnail;if(o.slide&&Array.isArray(o.slide)&&o.slide.length>0){var e=o.slide[0];if(e.image&&e.image.url)return e.image.url;if(e.image&&"string"===typeof e.image)return e.image;if("string"===typeof e)return e}return o.featured_image?o.featured_image:"/static/404.png"}}};e.default=f}).call(this,t("df3c")["default"])}},[["141b","common/runtime","common/vendor"]]]);